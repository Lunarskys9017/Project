{"version":3,"file":"react-pin-field.cjs.production.min.js","sources":["../src/polyfills/keyboard-evt.ts","../src/utils/utils.ts","../src/pin-field/pin-field.tsx"],"sourcesContent":["/**\n * KeyboardEvent.key polyfill.\n *\n * @see https://github.com/soywod/keyboardevent-key-polyfill/blob/master/index.js\n */\n\nconst keyMap: {[key: number]: string | [string, string]} = {\n  3: \"Cancel\",\n  6: \"Help\",\n  8: \"Backspace\",\n  9: \"Tab\",\n  12: \"Clear\",\n  13: \"Enter\",\n  16: \"Shift\",\n  17: \"Control\",\n  18: \"Alt\",\n  19: \"Pause\",\n  20: \"CapsLock\",\n  27: \"Escape\",\n  28: \"Convert\",\n  29: \"NonConvert\",\n  30: \"Accept\",\n  31: \"ModeChange\",\n  32: \" \",\n  33: \"PageUp\",\n  34: \"PageDown\",\n  35: \"End\",\n  36: \"Home\",\n  37: \"ArrowLeft\",\n  38: \"ArrowUp\",\n  39: \"ArrowRight\",\n  40: \"ArrowDown\",\n  41: \"Select\",\n  42: \"Print\",\n  43: \"Execute\",\n  44: \"PrintScreen\",\n  45: \"Insert\",\n  46: \"Delete\",\n  48: [\"0\", \")\"],\n  49: [\"1\", \"!\"],\n  50: [\"2\", \"@\"],\n  51: [\"3\", \"#\"],\n  52: [\"4\", \"$\"],\n  53: [\"5\", \"%\"],\n  54: [\"6\", \"^\"],\n  55: [\"7\", \"&\"],\n  56: [\"8\", \"*\"],\n  57: [\"9\", \"(\"],\n  91: \"OS\",\n  93: \"ContextMenu\",\n  106: \"*\",\n  107: \"+\",\n  109: \"-\",\n  110: \".\",\n  111: \"/\",\n  144: \"NumLock\",\n  145: \"ScrollLock\",\n  181: \"VolumeMute\",\n  182: \"VolumeDown\",\n  183: \"VolumeUp\",\n  186: [\";\", \":\"],\n  187: [\"=\", \"+\"],\n  188: [\",\", \"<\"],\n  189: [\"-\", \"_\"],\n  190: [\".\", \">\"],\n  191: [\"/\", \"?\"],\n  192: [\"`\", \"~\"],\n  219: [\"[\", \"{\"],\n  220: [\"\\\\\", \"|\"],\n  221: [\"]\", \"}\"],\n  222: [\"'\", '\"'],\n  224: \"Meta\",\n  225: \"AltGraph\",\n  246: \"Attn\",\n  247: \"CrSel\",\n  248: \"ExSel\",\n  249: \"EraseEof\",\n  250: \"Play\",\n  251: \"ZoomOut\",\n};\n\n// Function keys (F1-24).\n\nlet i: number;\nfor (i = 1; i < 25; i += 1) {\n  keyMap[111 + i] = \"F\" + i;\n}\n\n// Printable ASCII characters.\n\nfor (i = 65; i < 91; i += 1) {\n  const letter = String.fromCharCode(i);\n  keyMap[i] = [letter.toLowerCase(), letter.toUpperCase()];\n}\n\n// Numbers on numeric keyboard.\n\nfor (i = 96; i < 106; i += 1) {\n  keyMap[i] = String.fromCharCode(i - 48);\n}\n\n/**\n * Find the key associated to a keyboard event.\n * Default to \"Unidentified\".\n */\nexport function getKeyFromKeyboardEvent(evt: KeyboardEvent): string {\n  if (evt.key && evt.key !== \"Unidentified\") {\n    return evt.key;\n  }\n\n  const key = keyMap[evt.which || evt.keyCode] || \"Unidentified\";\n\n  if (Array.isArray(key)) {\n    return key[+(evt.shiftKey || 0)];\n  }\n\n  return key;\n}\n\nexport default {\n  getKey: getKeyFromKeyboardEvent,\n};\n","export function noop(): void {\n  //\n}\n\nexport function range(start: number, length: number): number[] {\n  return Array.from({length}, (_, i) => i + start);\n}\n\nexport function omit<T extends Record<string, unknown>>(keys: string[], input: T): T {\n  let output: T = Object.create({});\n\n  for (let key in input) {\n    if (!keys.includes(key)) {\n      Object.assign(output, {[key]: input[key]});\n    }\n  }\n\n  return output;\n}\n","import React, {FC, forwardRef, useCallback, useImperativeHandle, useRef} from \"react\";\nimport {EffectReducer, StateReducer, useBireducer} from \"react-use-bireducer\";\n\nimport keyboardEventPolyfill from \"../polyfills/keyboard-evt\";\nimport {noop, range, omit} from \"../utils\";\n\nimport {\n  PinFieldDefaultProps as DefaultProps,\n  PinFieldInputProps as InputProps,\n  PinFieldProps as Props,\n  PinFieldNotifierProps as NotifierProps,\n  PinFieldState as State,\n  PinFieldAction as Action,\n  PinFieldEffect as Effect,\n} from \"./pin-field.types\";\n\nexport const NO_EFFECTS: Effect[] = [];\nexport const PROP_KEYS = [\"autoFocus\", \"length\", \"validate\", \"format\", \"debug\"];\nexport const HANDLER_KEYS = [\"onResolveKey\", \"onRejectKey\", \"onChange\", \"onComplete\"];\nexport const IGNORED_META_KEYS = [\"Alt\", \"Control\", \"Enter\", \"Meta\", \"Shift\", \"Tab\"];\n\nexport const defaultProps: DefaultProps = {\n  ref: {current: []},\n  length: 5,\n  validate: /^[a-zA-Z0-9]$/,\n  format: key => key,\n  onResolveKey: noop,\n  onRejectKey: noop,\n  onChange: noop,\n  onComplete: noop,\n  debug: false,\n};\n\nexport function defaultState(props: Pick<DefaultProps, \"validate\" | \"length\">): State {\n  return {\n    focusIdx: 0,\n    codeLength: props.length,\n    isKeyAllowed: isKeyAllowed(props.validate),\n    fallback: null,\n  };\n}\n\nexport function getPrevFocusIdx(currFocusIdx: number) {\n  return Math.max(0, currFocusIdx - 1);\n}\n\nexport function getNextFocusIdx(currFocusIdx: number, lastFocusIdx: number) {\n  if (lastFocusIdx === 0) return 0;\n  return Math.min(currFocusIdx + 1, lastFocusIdx - 1);\n}\n\nexport function isKeyAllowed(predicate: DefaultProps[\"validate\"]) {\n  return (key: string) => {\n    if (!key) return false;\n    if (key.length > 1) return false;\n    if (typeof predicate === \"string\") return predicate.split(\"\").includes(key);\n    if (predicate instanceof Array) return predicate.includes(key);\n    if (predicate instanceof RegExp) return predicate.test(key);\n    return predicate(key);\n  };\n}\n\nexport function pasteReducer(state: State, idx: number, val: string): [State, Effect[]] {\n  const areAllKeysAllowed = val\n    .split(\"\")\n    .slice(0, state.codeLength)\n    .every(state.isKeyAllowed);\n\n  if (!areAllKeysAllowed) {\n    return [\n      state,\n      [\n        {type: \"set-input-val\", idx: state.focusIdx, val: \"\"},\n        {type: \"reject-key\", idx, key: val},\n        {type: \"handle-code-change\"},\n      ],\n    ];\n  }\n\n  const pasteLen = Math.min(val.length, state.codeLength - state.focusIdx);\n  const nextFocusIdx = getNextFocusIdx(pasteLen + state.focusIdx - 1, state.codeLength);\n  const effects: Effect[] = range(0, pasteLen).flatMap(idx => [\n    {\n      type: \"set-input-val\",\n      idx: idx + state.focusIdx,\n      val: val[idx],\n    },\n    {\n      type: \"resolve-key\",\n      idx: idx + state.focusIdx,\n      key: val[idx],\n    },\n  ]);\n\n  if (state.focusIdx !== nextFocusIdx) {\n    effects.push({type: \"focus-input\", idx: nextFocusIdx});\n  }\n\n  effects.push({type: \"handle-code-change\"});\n\n  return [{...state, focusIdx: nextFocusIdx}, effects];\n}\n\nexport const stateReducer: StateReducer<State, Action, Effect> = (state, action) => {\n  switch (action.type) {\n    case \"handle-key-down\": {\n      switch (action.key) {\n        case \"Unidentified\": {\n          return [{...state, fallback: {idx: state.focusIdx, val: action.val}}, NO_EFFECTS];\n        }\n\n        case \"Dead\": {\n          return [\n            state,\n            [\n              {type: \"set-input-val\", idx: state.focusIdx, val: \"\"},\n              {type: \"reject-key\", idx: state.focusIdx, key: action.key},\n              {type: \"handle-code-change\"},\n            ],\n          ];\n        }\n\n        case \"ArrowLeft\": {\n          const prevFocusIdx = getPrevFocusIdx(state.focusIdx);\n          return [{...state, focusIdx: prevFocusIdx}, [{type: \"focus-input\", idx: prevFocusIdx}]];\n        }\n\n        case \"ArrowRight\": {\n          const nextFocusIdx = getNextFocusIdx(state.focusIdx, state.codeLength);\n          return [{...state, focusIdx: nextFocusIdx}, [{type: \"focus-input\", idx: nextFocusIdx}]];\n        }\n\n        case \"Delete\":\n        case \"Backspace\": {\n          return [state, [{type: \"handle-delete\", idx: state.focusIdx}, {type: \"handle-code-change\"}]];\n        }\n\n        default: {\n          if (!state.isKeyAllowed(action.key)) {\n            return [state, [{type: \"reject-key\", idx: state.focusIdx, key: action.key}]];\n          }\n\n          const nextFocusIdx = getNextFocusIdx(state.focusIdx, state.codeLength);\n          return [\n            {...state, focusIdx: nextFocusIdx},\n            [\n              {type: \"set-input-val\", idx: state.focusIdx, val: action.key},\n              {type: \"resolve-key\", idx: state.focusIdx, key: action.key},\n              {type: \"focus-input\", idx: nextFocusIdx},\n              {type: \"handle-code-change\"},\n            ],\n          ];\n        }\n      }\n    }\n\n    case \"handle-key-up\": {\n      if (!state.fallback) {\n        return [state, NO_EFFECTS];\n      }\n\n      const nextState: State = {...state, fallback: null};\n      const effects: Effect[] = [];\n      const {idx, val: prevVal} = state.fallback;\n      const val = action.val;\n\n      if (prevVal === \"\" && val === \"\") {\n        effects.push({type: \"handle-delete\", idx}, {type: \"handle-code-change\"});\n      } else if (prevVal === \"\" && val !== \"\") {\n        return pasteReducer(nextState, idx, val);\n      }\n\n      return [nextState, effects];\n    }\n\n    case \"handle-paste\": {\n      return pasteReducer(state, action.idx, action.val);\n    }\n\n    case \"focus-input\": {\n      return [{...state, focusIdx: action.idx}, [{type: \"focus-input\", idx: action.idx}]];\n    }\n\n    default: {\n      return [state, NO_EFFECTS];\n    }\n  }\n};\n\nexport function useEffectReducer({refs, ...props}: NotifierProps): EffectReducer<Effect, Action> {\n  return useCallback(\n    effect => {\n      switch (effect.type) {\n        case \"focus-input\": {\n          refs.current[effect.idx].focus();\n          break;\n        }\n\n        case \"set-input-val\": {\n          const val = props.format(effect.val);\n          refs.current[effect.idx].value = val;\n          break;\n        }\n\n        case \"resolve-key\": {\n          refs.current[effect.idx].setCustomValidity(\"\");\n          props.onResolveKey(effect.key, refs.current[effect.idx]);\n          break;\n        }\n\n        case \"reject-key\": {\n          refs.current[effect.idx].setCustomValidity(\"Invalid key\");\n          props.onRejectKey(effect.key, refs.current[effect.idx]);\n          break;\n        }\n\n        case \"handle-delete\": {\n          const prevVal = refs.current[effect.idx].value;\n          refs.current[effect.idx].setCustomValidity(\"\");\n          refs.current[effect.idx].value = \"\";\n\n          if (!prevVal) {\n            const prevIdx = getPrevFocusIdx(effect.idx);\n            refs.current[prevIdx].focus();\n            refs.current[prevIdx].setCustomValidity(\"\");\n            refs.current[prevIdx].value = \"\";\n          }\n\n          break;\n        }\n\n        case \"handle-code-change\": {\n          const dir = (props.dir || document.documentElement.getAttribute(\"dir\") || \"ltr\").toLowerCase();\n          const codeArr = refs.current.map(r => r.value.trim());\n          const code = (dir === \"rtl\" ? codeArr.reverse() : codeArr).join(\"\");\n          props.onChange(code);\n          code.length === props.length && props.onComplete(code);\n          break;\n        }\n\n        default: {\n          break;\n        }\n      }\n    },\n    [props, refs],\n  );\n}\n\nexport const PinField: FC<Props> = forwardRef((customProps, fwdRef) => {\n  const props: DefaultProps & InputProps = {...defaultProps, ...customProps};\n  const {autoFocus, length: codeLength} = props;\n  const inputProps: InputProps = omit([...PROP_KEYS, ...HANDLER_KEYS], props);\n  const refs = useRef<HTMLInputElement[]>([]);\n  const effectReducer = useEffectReducer({refs, ...props});\n  const dispatch = useBireducer(stateReducer, effectReducer, defaultState(props))[1];\n\n  useImperativeHandle(fwdRef, () => refs.current, [refs]);\n\n  function handleFocus(idx: number) {\n    return function() {\n      dispatch({type: \"focus-input\", idx});\n    };\n  }\n\n  function handleKeyDown(idx: number) {\n    return function(evt: React.KeyboardEvent<HTMLInputElement>) {\n      const key = keyboardEventPolyfill.getKey(evt.nativeEvent);\n      if (\n        !IGNORED_META_KEYS.includes(key) &&\n        !evt.ctrlKey &&\n        !evt.altKey &&\n        !evt.metaKey &&\n        evt.nativeEvent.target instanceof HTMLInputElement\n      ) {\n        evt.preventDefault();\n        dispatch({type: \"handle-key-down\", idx, key, val: evt.nativeEvent.target.value});\n      }\n    };\n  }\n\n  function handleKeyUp(idx: number) {\n    return function(evt: React.KeyboardEvent<HTMLInputElement>) {\n      if (evt.nativeEvent.target instanceof HTMLInputElement) {\n        dispatch({type: \"handle-key-up\", idx, val: evt.nativeEvent.target.value});\n      }\n    };\n  }\n\n  function handlePaste(idx: number) {\n    return function(evt: React.ClipboardEvent<HTMLInputElement>) {\n      evt.preventDefault();\n      const val = evt.clipboardData.getData(\"Text\");\n      dispatch({type: \"handle-paste\", idx, val});\n    };\n  }\n\n  function setRefAtIndex(idx: number) {\n    return function(ref: HTMLInputElement) {\n      if (ref) {\n        refs.current[idx] = ref;\n      }\n    };\n  }\n\n  function hasAutoFocus(idx: number) {\n    return Boolean(idx === 0 && autoFocus);\n  }\n\n  return (\n    <>\n      {range(0, codeLength).map(idx => (\n        <input\n          type=\"text\"\n          autoCapitalize=\"off\"\n          autoCorrect=\"off\"\n          autoComplete=\"off\"\n          inputMode=\"text\"\n          {...inputProps}\n          key={idx}\n          ref={setRefAtIndex(idx)}\n          autoFocus={hasAutoFocus(idx)}\n          onFocus={handleFocus(idx)}\n          onKeyDown={handleKeyDown(idx)}\n          onKeyUp={handleKeyUp(idx)}\n          onPaste={handlePaste(idx)}\n        />\n      ))}\n    </>\n  );\n});\n\nexport default PinField;\n"],"names":["i","keyMap","3","6","8","9","12","13","16","17","18","19","20","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","48","49","50","51","52","53","54","55","56","57","91","93","106","107","109","110","111","144","145","181","182","183","186","187","188","189","190","191","192","219","220","221","222","224","225","246","247","248","249","250","251","letter","String","fromCharCode","toLowerCase","toUpperCase","noop","range","start","length","Array","from","_","NO_EFFECTS","PROP_KEYS","HANDLER_KEYS","IGNORED_META_KEYS","defaultProps","ref","current","validate","format","key","onResolveKey","onRejectKey","onChange","onComplete","debug","defaultState","props","focusIdx","codeLength","isKeyAllowed","fallback","getPrevFocusIdx","currFocusIdx","Math","max","getNextFocusIdx","lastFocusIdx","min","predicate","split","includes","RegExp","test","pasteReducer","state","idx","val","slice","every","type","pasteLen","nextFocusIdx","effects","flatMap","push","stateReducer","action","prevFocusIdx","nextState","prevVal","useEffectReducer","refs","useCallback","effect","focus","value","setCustomValidity","prevIdx","dir","document","documentElement","getAttribute","codeArr","map","r","trim","code","reverse","join","PinField","forwardRef","customProps","fwdRef","autoFocus","inputProps","keys","input","output","Object","create","assign","omit","useRef","effectReducer","dispatch","useBireducer","handleFocus","handleKeyDown","evt","which","keyCode","isArray","shiftKey","keyboardEventPolyfill","nativeEvent","ctrlKey","altKey","metaKey","target","HTMLInputElement","preventDefault","handleKeyUp","handlePaste","clipboardData","getData","setRefAtIndex","hasAutoFocus","Boolean","useImperativeHandle","React","autoCapitalize","autoCorrect","autoComplete","inputMode","onFocus","onKeyDown","onKeyUp","onPaste"],"mappings":"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"}