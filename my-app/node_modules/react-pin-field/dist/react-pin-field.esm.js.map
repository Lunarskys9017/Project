{"version":3,"file":"react-pin-field.esm.js","sources":["../src/polyfills/keyboard-evt.ts","../src/utils/utils.ts","../src/pin-field/pin-field.tsx"],"sourcesContent":["/**\n * KeyboardEvent.key polyfill.\n *\n * @see https://github.com/soywod/keyboardevent-key-polyfill/blob/master/index.js\n */\n\nconst keyMap: {[key: number]: string | [string, string]} = {\n  3: \"Cancel\",\n  6: \"Help\",\n  8: \"Backspace\",\n  9: \"Tab\",\n  12: \"Clear\",\n  13: \"Enter\",\n  16: \"Shift\",\n  17: \"Control\",\n  18: \"Alt\",\n  19: \"Pause\",\n  20: \"CapsLock\",\n  27: \"Escape\",\n  28: \"Convert\",\n  29: \"NonConvert\",\n  30: \"Accept\",\n  31: \"ModeChange\",\n  32: \" \",\n  33: \"PageUp\",\n  34: \"PageDown\",\n  35: \"End\",\n  36: \"Home\",\n  37: \"ArrowLeft\",\n  38: \"ArrowUp\",\n  39: \"ArrowRight\",\n  40: \"ArrowDown\",\n  41: \"Select\",\n  42: \"Print\",\n  43: \"Execute\",\n  44: \"PrintScreen\",\n  45: \"Insert\",\n  46: \"Delete\",\n  48: [\"0\", \")\"],\n  49: [\"1\", \"!\"],\n  50: [\"2\", \"@\"],\n  51: [\"3\", \"#\"],\n  52: [\"4\", \"$\"],\n  53: [\"5\", \"%\"],\n  54: [\"6\", \"^\"],\n  55: [\"7\", \"&\"],\n  56: [\"8\", \"*\"],\n  57: [\"9\", \"(\"],\n  91: \"OS\",\n  93: \"ContextMenu\",\n  106: \"*\",\n  107: \"+\",\n  109: \"-\",\n  110: \".\",\n  111: \"/\",\n  144: \"NumLock\",\n  145: \"ScrollLock\",\n  181: \"VolumeMute\",\n  182: \"VolumeDown\",\n  183: \"VolumeUp\",\n  186: [\";\", \":\"],\n  187: [\"=\", \"+\"],\n  188: [\",\", \"<\"],\n  189: [\"-\", \"_\"],\n  190: [\".\", \">\"],\n  191: [\"/\", \"?\"],\n  192: [\"`\", \"~\"],\n  219: [\"[\", \"{\"],\n  220: [\"\\\\\", \"|\"],\n  221: [\"]\", \"}\"],\n  222: [\"'\", '\"'],\n  224: \"Meta\",\n  225: \"AltGraph\",\n  246: \"Attn\",\n  247: \"CrSel\",\n  248: \"ExSel\",\n  249: \"EraseEof\",\n  250: \"Play\",\n  251: \"ZoomOut\",\n};\n\n// Function keys (F1-24).\n\nlet i: number;\nfor (i = 1; i < 25; i += 1) {\n  keyMap[111 + i] = \"F\" + i;\n}\n\n// Printable ASCII characters.\n\nfor (i = 65; i < 91; i += 1) {\n  const letter = String.fromCharCode(i);\n  keyMap[i] = [letter.toLowerCase(), letter.toUpperCase()];\n}\n\n// Numbers on numeric keyboard.\n\nfor (i = 96; i < 106; i += 1) {\n  keyMap[i] = String.fromCharCode(i - 48);\n}\n\n/**\n * Find the key associated to a keyboard event.\n * Default to \"Unidentified\".\n */\nexport function getKeyFromKeyboardEvent(evt: KeyboardEvent): string {\n  if (evt.key && evt.key !== \"Unidentified\") {\n    return evt.key;\n  }\n\n  const key = keyMap[evt.which || evt.keyCode] || \"Unidentified\";\n\n  if (Array.isArray(key)) {\n    return key[+(evt.shiftKey || 0)];\n  }\n\n  return key;\n}\n\nexport default {\n  getKey: getKeyFromKeyboardEvent,\n};\n","export function noop(): void {\n  //\n}\n\nexport function range(start: number, length: number): number[] {\n  return Array.from({length}, (_, i) => i + start);\n}\n\nexport function omit<T extends Record<string, unknown>>(keys: string[], input: T): T {\n  let output: T = Object.create({});\n\n  for (let key in input) {\n    if (!keys.includes(key)) {\n      Object.assign(output, {[key]: input[key]});\n    }\n  }\n\n  return output;\n}\n","import React, {FC, forwardRef, useCallback, useImperativeHandle, useRef} from \"react\";\nimport {EffectReducer, StateReducer, useBireducer} from \"react-use-bireducer\";\n\nimport keyboardEventPolyfill from \"../polyfills/keyboard-evt\";\nimport {noop, range, omit} from \"../utils\";\n\nimport {\n  PinFieldDefaultProps as DefaultProps,\n  PinFieldInputProps as InputProps,\n  PinFieldProps as Props,\n  PinFieldNotifierProps as NotifierProps,\n  PinFieldState as State,\n  PinFieldAction as Action,\n  PinFieldEffect as Effect,\n} from \"./pin-field.types\";\n\nexport const NO_EFFECTS: Effect[] = [];\nexport const PROP_KEYS = [\"autoFocus\", \"length\", \"validate\", \"format\", \"debug\"];\nexport const HANDLER_KEYS = [\"onResolveKey\", \"onRejectKey\", \"onChange\", \"onComplete\"];\nexport const IGNORED_META_KEYS = [\"Alt\", \"Control\", \"Enter\", \"Meta\", \"Shift\", \"Tab\"];\n\nexport const defaultProps: DefaultProps = {\n  ref: {current: []},\n  length: 5,\n  validate: /^[a-zA-Z0-9]$/,\n  format: key => key,\n  onResolveKey: noop,\n  onRejectKey: noop,\n  onChange: noop,\n  onComplete: noop,\n  debug: false,\n};\n\nexport function defaultState(props: Pick<DefaultProps, \"validate\" | \"length\">): State {\n  return {\n    focusIdx: 0,\n    codeLength: props.length,\n    isKeyAllowed: isKeyAllowed(props.validate),\n    fallback: null,\n  };\n}\n\nexport function getPrevFocusIdx(currFocusIdx: number) {\n  return Math.max(0, currFocusIdx - 1);\n}\n\nexport function getNextFocusIdx(currFocusIdx: number, lastFocusIdx: number) {\n  if (lastFocusIdx === 0) return 0;\n  return Math.min(currFocusIdx + 1, lastFocusIdx - 1);\n}\n\nexport function isKeyAllowed(predicate: DefaultProps[\"validate\"]) {\n  return (key: string) => {\n    if (!key) return false;\n    if (key.length > 1) return false;\n    if (typeof predicate === \"string\") return predicate.split(\"\").includes(key);\n    if (predicate instanceof Array) return predicate.includes(key);\n    if (predicate instanceof RegExp) return predicate.test(key);\n    return predicate(key);\n  };\n}\n\nexport function pasteReducer(state: State, idx: number, val: string): [State, Effect[]] {\n  const areAllKeysAllowed = val\n    .split(\"\")\n    .slice(0, state.codeLength)\n    .every(state.isKeyAllowed);\n\n  if (!areAllKeysAllowed) {\n    return [\n      state,\n      [\n        {type: \"set-input-val\", idx: state.focusIdx, val: \"\"},\n        {type: \"reject-key\", idx, key: val},\n        {type: \"handle-code-change\"},\n      ],\n    ];\n  }\n\n  const pasteLen = Math.min(val.length, state.codeLength - state.focusIdx);\n  const nextFocusIdx = getNextFocusIdx(pasteLen + state.focusIdx - 1, state.codeLength);\n  const effects: Effect[] = range(0, pasteLen).flatMap(idx => [\n    {\n      type: \"set-input-val\",\n      idx: idx + state.focusIdx,\n      val: val[idx],\n    },\n    {\n      type: \"resolve-key\",\n      idx: idx + state.focusIdx,\n      key: val[idx],\n    },\n  ]);\n\n  if (state.focusIdx !== nextFocusIdx) {\n    effects.push({type: \"focus-input\", idx: nextFocusIdx});\n  }\n\n  effects.push({type: \"handle-code-change\"});\n\n  return [{...state, focusIdx: nextFocusIdx}, effects];\n}\n\nexport const stateReducer: StateReducer<State, Action, Effect> = (state, action) => {\n  switch (action.type) {\n    case \"handle-key-down\": {\n      switch (action.key) {\n        case \"Unidentified\": {\n          return [{...state, fallback: {idx: state.focusIdx, val: action.val}}, NO_EFFECTS];\n        }\n\n        case \"Dead\": {\n          return [\n            state,\n            [\n              {type: \"set-input-val\", idx: state.focusIdx, val: \"\"},\n              {type: \"reject-key\", idx: state.focusIdx, key: action.key},\n              {type: \"handle-code-change\"},\n            ],\n          ];\n        }\n\n        case \"ArrowLeft\": {\n          const prevFocusIdx = getPrevFocusIdx(state.focusIdx);\n          return [{...state, focusIdx: prevFocusIdx}, [{type: \"focus-input\", idx: prevFocusIdx}]];\n        }\n\n        case \"ArrowRight\": {\n          const nextFocusIdx = getNextFocusIdx(state.focusIdx, state.codeLength);\n          return [{...state, focusIdx: nextFocusIdx}, [{type: \"focus-input\", idx: nextFocusIdx}]];\n        }\n\n        case \"Delete\":\n        case \"Backspace\": {\n          return [state, [{type: \"handle-delete\", idx: state.focusIdx}, {type: \"handle-code-change\"}]];\n        }\n\n        default: {\n          if (!state.isKeyAllowed(action.key)) {\n            return [state, [{type: \"reject-key\", idx: state.focusIdx, key: action.key}]];\n          }\n\n          const nextFocusIdx = getNextFocusIdx(state.focusIdx, state.codeLength);\n          return [\n            {...state, focusIdx: nextFocusIdx},\n            [\n              {type: \"set-input-val\", idx: state.focusIdx, val: action.key},\n              {type: \"resolve-key\", idx: state.focusIdx, key: action.key},\n              {type: \"focus-input\", idx: nextFocusIdx},\n              {type: \"handle-code-change\"},\n            ],\n          ];\n        }\n      }\n    }\n\n    case \"handle-key-up\": {\n      if (!state.fallback) {\n        return [state, NO_EFFECTS];\n      }\n\n      const nextState: State = {...state, fallback: null};\n      const effects: Effect[] = [];\n      const {idx, val: prevVal} = state.fallback;\n      const val = action.val;\n\n      if (prevVal === \"\" && val === \"\") {\n        effects.push({type: \"handle-delete\", idx}, {type: \"handle-code-change\"});\n      } else if (prevVal === \"\" && val !== \"\") {\n        return pasteReducer(nextState, idx, val);\n      }\n\n      return [nextState, effects];\n    }\n\n    case \"handle-paste\": {\n      return pasteReducer(state, action.idx, action.val);\n    }\n\n    case \"focus-input\": {\n      return [{...state, focusIdx: action.idx}, [{type: \"focus-input\", idx: action.idx}]];\n    }\n\n    default: {\n      return [state, NO_EFFECTS];\n    }\n  }\n};\n\nexport function useEffectReducer({refs, ...props}: NotifierProps): EffectReducer<Effect, Action> {\n  return useCallback(\n    effect => {\n      switch (effect.type) {\n        case \"focus-input\": {\n          refs.current[effect.idx].focus();\n          break;\n        }\n\n        case \"set-input-val\": {\n          const val = props.format(effect.val);\n          refs.current[effect.idx].value = val;\n          break;\n        }\n\n        case \"resolve-key\": {\n          refs.current[effect.idx].setCustomValidity(\"\");\n          props.onResolveKey(effect.key, refs.current[effect.idx]);\n          break;\n        }\n\n        case \"reject-key\": {\n          refs.current[effect.idx].setCustomValidity(\"Invalid key\");\n          props.onRejectKey(effect.key, refs.current[effect.idx]);\n          break;\n        }\n\n        case \"handle-delete\": {\n          const prevVal = refs.current[effect.idx].value;\n          refs.current[effect.idx].setCustomValidity(\"\");\n          refs.current[effect.idx].value = \"\";\n\n          if (!prevVal) {\n            const prevIdx = getPrevFocusIdx(effect.idx);\n            refs.current[prevIdx].focus();\n            refs.current[prevIdx].setCustomValidity(\"\");\n            refs.current[prevIdx].value = \"\";\n          }\n\n          break;\n        }\n\n        case \"handle-code-change\": {\n          const dir = (props.dir || document.documentElement.getAttribute(\"dir\") || \"ltr\").toLowerCase();\n          const codeArr = refs.current.map(r => r.value.trim());\n          const code = (dir === \"rtl\" ? codeArr.reverse() : codeArr).join(\"\");\n          props.onChange(code);\n          code.length === props.length && props.onComplete(code);\n          break;\n        }\n\n        default: {\n          break;\n        }\n      }\n    },\n    [props, refs],\n  );\n}\n\nexport const PinField: FC<Props> = forwardRef((customProps, fwdRef) => {\n  const props: DefaultProps & InputProps = {...defaultProps, ...customProps};\n  const {autoFocus, length: codeLength} = props;\n  const inputProps: InputProps = omit([...PROP_KEYS, ...HANDLER_KEYS], props);\n  const refs = useRef<HTMLInputElement[]>([]);\n  const effectReducer = useEffectReducer({refs, ...props});\n  const dispatch = useBireducer(stateReducer, effectReducer, defaultState(props))[1];\n\n  useImperativeHandle(fwdRef, () => refs.current, [refs]);\n\n  function handleFocus(idx: number) {\n    return function() {\n      dispatch({type: \"focus-input\", idx});\n    };\n  }\n\n  function handleKeyDown(idx: number) {\n    return function(evt: React.KeyboardEvent<HTMLInputElement>) {\n      const key = keyboardEventPolyfill.getKey(evt.nativeEvent);\n      if (\n        !IGNORED_META_KEYS.includes(key) &&\n        !evt.ctrlKey &&\n        !evt.altKey &&\n        !evt.metaKey &&\n        evt.nativeEvent.target instanceof HTMLInputElement\n      ) {\n        evt.preventDefault();\n        dispatch({type: \"handle-key-down\", idx, key, val: evt.nativeEvent.target.value});\n      }\n    };\n  }\n\n  function handleKeyUp(idx: number) {\n    return function(evt: React.KeyboardEvent<HTMLInputElement>) {\n      if (evt.nativeEvent.target instanceof HTMLInputElement) {\n        dispatch({type: \"handle-key-up\", idx, val: evt.nativeEvent.target.value});\n      }\n    };\n  }\n\n  function handlePaste(idx: number) {\n    return function(evt: React.ClipboardEvent<HTMLInputElement>) {\n      evt.preventDefault();\n      const val = evt.clipboardData.getData(\"Text\");\n      dispatch({type: \"handle-paste\", idx, val});\n    };\n  }\n\n  function setRefAtIndex(idx: number) {\n    return function(ref: HTMLInputElement) {\n      if (ref) {\n        refs.current[idx] = ref;\n      }\n    };\n  }\n\n  function hasAutoFocus(idx: number) {\n    return Boolean(idx === 0 && autoFocus);\n  }\n\n  return (\n    <>\n      {range(0, codeLength).map(idx => (\n        <input\n          type=\"text\"\n          autoCapitalize=\"off\"\n          autoCorrect=\"off\"\n          autoComplete=\"off\"\n          inputMode=\"text\"\n          {...inputProps}\n          key={idx}\n          ref={setRefAtIndex(idx)}\n          autoFocus={hasAutoFocus(idx)}\n          onFocus={handleFocus(idx)}\n          onKeyDown={handleKeyDown(idx)}\n          onKeyUp={handleKeyUp(idx)}\n          onPaste={handlePaste(idx)}\n        />\n      ))}\n    </>\n  );\n});\n\nexport default PinField;\n"],"names":["keyMap","i","letter","String","fromCharCode","toLowerCase","toUpperCase","getKeyFromKeyboardEvent","evt","key","which","keyCode","Array","isArray","shiftKey","getKey","noop","range","start","length","from","_","omit","keys","input","output","Object","create","includes","assign","NO_EFFECTS","PROP_KEYS","HANDLER_KEYS","IGNORED_META_KEYS","defaultProps","ref","current","validate","format","onResolveKey","onRejectKey","onChange","onComplete","debug","defaultState","props","focusIdx","codeLength","isKeyAllowed","fallback","getPrevFocusIdx","currFocusIdx","Math","max","getNextFocusIdx","lastFocusIdx","min","predicate","split","RegExp","test","pasteReducer","state","idx","val","areAllKeysAllowed","slice","every","type","pasteLen","nextFocusIdx","effects","flatMap","push","stateReducer","action","prevFocusIdx","nextState","prevVal","useEffectReducer","refs","useCallback","effect","focus","value","setCustomValidity","prevIdx","dir","document","documentElement","getAttribute","codeArr","map","r","trim","code","reverse","join","PinField","forwardRef","customProps","fwdRef","autoFocus","inputProps","useRef","effectReducer","dispatch","useBireducer","useImperativeHandle","handleFocus","handleKeyDown","keyboardEventPolyfill","nativeEvent","ctrlKey","altKey","metaKey","target","HTMLInputElement","preventDefault","handleKeyUp","handlePaste","clipboardData","getData","setRefAtIndex","hasAutoFocus","Boolean","React","autoCapitalize","autoCorrect","autoComplete","inputMode","onFocus","onKeyDown","onKeyUp","onPaste"],"mappings":"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"}